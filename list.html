<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv='cache-control' content='no-cache'> 
<meta http-equiv='expires' content='0'> 
<meta http-equiv='pragma' content='no-cache'>
    <meta name="viewport" content="width=1280, height=720, initial-scale=1, maximum-scale=1">
    <title>Большой канон фанфиков списком</title>
     <style type="text/css">  

      html, body { margin:0; padding:0; overflow:visible }
svg { position:absolute; top:0; bottom:0; left:0; right:0 }
 
.author_td
{
  width: max-content;
}
a { 
    float:left;
    clear:left;
}


table {
  text-align: left;
  position: relative;
  border-collapse: collapse; 
  background-color: white;
  width:100%;
}/* Spacing */
td, th {
  border: 1px solid #999;
  padding: 20px;
}
th {
  background: white;
  color: black;
  border-radius: 0;
  position: sticky;
  top: 0;
  padding: 10px;
}
.primary{
  background-color: #000000
}

tfoot > tr  {
  background: black;
  color: white;
}
tbody > tr:hover {
  background-color: #fdd700;
}

tr
{
  scroll-margin-top: 200px;
}


table {
  margin-top: 3em;
  border: 1px;
}

textarea
{
  width:100%;
}

 .button {
        top: 0%; 
        position: absolute;
        border-radius: 10px;
        width: 100px;
        height: 50px;
        z-index: 2;
    }

.instr
    {
        z-index:100;
        width:500px;
        height:500px;
        background-color: #ffffff;
        margin:auto;
        position:fixed;
        top: 10px;
        left: 300px;
        border: 1px solid;
        border-radius: 5px;
        word-wrap: break-word;
        white-space:pre-wrap;
        padding:10px;
    }



    </style>

  </head>
  

  <body style="background: rgb(255, 255, 255) repeat scroll top left; margin: 0pt; ">

     <!-- -->



    <script  type="module">

      var a=document.getElementById("main");

      var faq = document.createElement("button");
      faq.className = faq.className + "button";
      faq.textContent='Как это работает?';
      faq.onclick = function(){
      var d= document.createElement("div");
                    d.className=d.className+'instr';
                    d.id='manual'+Math.random()*1000;
                    
                    d.style.height="200px";
                    d.style.width="500px";
                    var rules="Как это работает?\nПеред вами список фанфиков БКФ со ссылками, а также указанием авторов и межтекстовых связей. Если вам больше нравится схема, к ней можно вернуться по самой правой кнопке. \nСсылки на предков и потомков ведут на строчки этой же таблицы, чтобы клубок можно было распутать.\n\n";
                    var tn = document.createTextNode(rules);
                    
                    var btn = document.createElement("button");
                    btn.className = btn.className + "button";
                    btn.textContent='Понятно';
                    btn.style.position="relative";
                    btn.style.left="200px";
                    btn.style.align="center";
                    btn.onclick = function() {document.getElementById(d.id).style.display = "none"; };

                    d.appendChild(tn);
                    d.appendChild(btn);
                    a.appendChild(d);

                    }; 
      a.appendChild(faq);

      var feedback = document.createElement("button");
      feedback.className = feedback.className + "button";
      feedback.textContent='Тут не хватает!';
      feedback.style.left="100px";
      feedback.onclick = function(){
    var d1= document.createElement("div");
                    d1.className=d1.className+'instr';
                    d1.id='fb'+Math.random()*1000;
                    
                    d1.style.height="500px";
                    d1.style.width="500px";
                    
                    var tn1 = document.createTextNode("Я знаю еще фанфики! Вставьте сюда ссылки:\n");
                    var ta1= document.createElement('textarea');
                    ta1.id='newnodes';
                    var ta2= document.createElement('textarea');
                    ta2.id='newlinks';
                    var ta3= document.createElement('textarea');
                    ta3.id='words';
                    var tn2 = document.createTextNode("\nОно сильнее сплетается! Напишите сюда связи:\n");

                    var tn3 = document.createTextNode("\nЯ просто хочу высказаться:\n");
                    
                    var tn4 = document.createTextNode("\n\n");
                    var btn2 = document.createElement("button");
                    btn2.className = btn2.className + "button";
                    btn2.textContent='Отправить!';
                    btn2.style.position="relative";
                    btn2.style.left="100px";
                    btn2.style.align="center";
                    btn2.onclick = function() {
                      var http = new XMLHttpRequest();
                      var url = 'https://api.telegram.org/bot5041328563:AAHSUMqtWJN1TV-enQoauWAIwf-g97qA1cc/sendMessage';
                      http.open('POST', url, true);
                      http.setRequestHeader('Content-Type', 'application/json');
                      http.onreadystatechange = function() {//Call a function when the state changes.
                            if(http.readyState == 4 && http.status == 200) {
                            //alert(http.responseText);
                            }
                      }
                      http.send(JSON.stringify({"chat_id": "-807254052", "text": "NODES: "+document.getElementById("newnodes").value+"     LINKS: "+document.getElementById("newlinks").value+"    FEEDBACK: "+document.getElementById("words").value, "disable_notification": true}));
                      document.getElementById(d1.id).style.display = "none"; };

                    var btn3 = document.createElement("button");
                    btn3.className = btn3.className + "button";
                    btn3.textContent='Не хочу!';
                    btn3.style.position="relative";
                    btn3.style.left="200px";
                    btn3.style.align="center";
                    btn3.onclick = function() {
                      document.getElementById(d1.id).style.display = "none"; };
                    d1.appendChild(tn1);
                    d1.appendChild(ta1);
                    d1.appendChild(tn2);
                    d1.appendChild(ta2);
                    d1.appendChild(tn3);
                    d1.appendChild(ta3);
                    d1.appendChild(tn4);
                    d1.appendChild(btn2);
                    d1.appendChild(btn3);
                    a.appendChild(d1);
                    document.getElementById(d1.id).innerHtml+='<span id="close2" onclick="this.parentNode.parentNode.remove(); return false;">x</span>';
                    };
      a.appendChild(feedback);

      var lst = document.createElement("button");
      lst.className = lst.className + "button";
      lst.textContent='Смотреть схемой';
      lst.onclick = function(){window.location.href='index.html';};
      //lst.href="list.html";
      lst.style.left="200px";
      a.appendChild(lst);
      

import data from './json.json' with { type: 'json' };
var links = data.links;

var nodes = data.nodes;

var authors = data.authors;


var predecessors = [];
var successors = [];

for (let i = 0; i < nodes.length; i++)
{
  predecessors[i]=[];
  successors[i]=[];
}

for (let i = 0; i < links.length; i++)
{
  predecessors[links[i]["target"]].push(links[i]["source"]);
  successors[links[i]["source"]].push(links[i]["target"]);
}

var t = document.getElementById("fanfics");

for (let i = 0; i < nodes.length; i++)
{
  var tr = document.createElement('tr'); 
  tr.id='row_'+i.toString();
  var txt=document.createElement('td');
  txt.id='text_'+i.toString();
  var txt_=document.createElement('a');
  txt_.text=nodes[i]["label"];
  txt_.href=nodes[i]["link"];
  txt.appendChild(txt_);
  if (nodes[i]["canon"])
  {
    txt.appendChild(document.createTextNode(String.fromCodePoint(128994)));
  }
  else if (nodes[i]["cherry"])
  {
    txt.appendChild(document.createTextNode(String.fromCodePoint(127826)));
  }
  else 
  {
    txt.appendChild(document.createTextNode(String.fromCodePoint(128993)));
  }
  var auth=document.createElement('td');
  auth.id='author_'+i.toString();
  auth.className='author_td';
  var a_id=parseInt(nodes[i]["author"]);
  if (authors[a_id]["link"] != 'null')
  {
  var auth_=document.createElement('a');
  auth_.text=authors[a_id]["name"];
  auth_.href=authors[a_id]["link"];
  auth.appendChild(auth_);
  } 
  else
  {
   var auth_=document.createTextNode(authors[a_id]["name"]);
   auth.appendChild(auth_); 
  }
  var preds=document.createElement('td');
  preds.id='preds_'+i.toString();
  for (let j=0; j<predecessors[i].length; j++)
  {
    var pred=document.createElement('a');
  pred.text=nodes[predecessors[i][j]]["label"]+'\n';
  pred.href="#row_"+predecessors[i][j].toString();
  preds.appendChild(pred);
  }
  var succs=document.createElement('td');
  succs.id='succs_'+i.toString();
  for (let j=0; j<successors[i].length; j++)
  {
    var succ=document.createElement('a');
  succ.text=nodes[successors[i][j]]["label"]+'\n';
  succ.href="#row_"+successors[i][j].toString();
  succs.appendChild(succ);
  } 
  tr.appendChild(txt);  
  tr.appendChild(auth);
  tr.appendChild(preds);
  tr.appendChild(succs);
  t.appendChild(tr);
  //document.getElementById('text_'+i.toString()).innerHtml='<a href="'+nodes[i]["link"]+'">'+nodes[i]["label"]+'</a>';
}

//console.log(links.filter(l => l.source==0));


    </script>

<div id="main">
  <table id="fanfics" style="top:50px; position:relative"><tr><th>Текст</th><th>Автор</th><th>Прямые предки</th><th>Прямые потомки</th></tr></table>
 
    </div>

</body>
</html>

